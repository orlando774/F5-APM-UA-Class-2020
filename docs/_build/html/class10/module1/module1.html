<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Lab 1: WebSSH and APM</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Lab 1: WebSSH and APM"/>
  <meta name="product" content="F5 Identity and Access Management Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-05-19 03:36:25"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Identity and Access Management Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lab 1: WebSSH and APM &#8212; F5 Identity and Access Management Solutions  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/index.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Lab Network Setup" href="../labinfo.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      <!-- javascript code to maintain the sidebar scroll positon when loaded -->
      <script type="text/javascript">
        $(function() {
          if (localStorage.tempScrollTop) {
            $('#sidebar').scrollTop(localStorage.tempScrollTop);
          }
        });
        $('#sidebar').on("scroll", function() {
          localStorage.setItem("tempScrollTop", $('#sidebar').scrollTop());
        });
      </script>
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Identity and Access Management Solutions  </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">Class 1: SAML Federation with F5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">Class 2: OAuth Federation with F5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">Class 3: SWG - Securing Outbound Internet Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">Class 4: SAML Identity Provider (IdP) Lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class5/class5.html">Class 5: AD FS Proxy Lab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class6/class6.html">Class 6: Federating Common Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class7/class7.html">Class 7: Introduction to Universal Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class8/class8.html">Class 8: Troubleshooting Universal Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class9/class9.html">Class 9: Multi-Factor Auth for Cloud Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class10.html">Class 10: Privileged User Access</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../labinfo.html">Lab Network Setup</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Lab 1: WebSSH and APM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#validation">Validation</a></li>
</ul>
</li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Lab 1: WebSSH and APM</a><ul>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#installation-overview">Installation Overview</a></li>
<li><a class="reference internal" href="#resource-table">Resource Table</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#offline-installation-method">Offline Installation Method</a></li>
<li><a class="reference internal" href="#run-installation-script">Run Installation Script</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validation">Validation</a><ul>
<li><a class="reference internal" href="#webssh2-client">WebSSH2 Client</a></li>
<li><a class="reference internal" href="#apm-policy-and-portal-mode">APM Policy and Portal Mode</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Identity and Access Management Solutions</a>
              &gt; <a href="../class10.html">Class 10: Privileged User Access</a>

          <span class="right">
             <a href="../../_sources/class10/module1/module1.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/osantiago774/f5-agility-labs-iam">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="lab-1-webssh-and-apm">
<h1>Lab 1: WebSSH and APM<a class="headerlink" href="#lab-1-webssh-and-apm" title="Permalink to this headline">¶</a></h1>
<p>The Privileged User Authentication (PUA) solution is made up of three
parts.</p>
<ol class="arabic simple">
<li>WebSSH2 Client Plugin</li>
<li>Ephemeral Authentication Plugin</li>
<li>Access Policy Manager (APM) policy configuration</li>
</ol>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>BIG-IP with TMOS v13.1.0.2 or greater.</li>
<li>1-5 IP addresses for virtual servers (see Resource
Table)</li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>BIG-IP with at least APM and iRules LX licensed and provisioned</p>
<p>The <cite>build_pua.zip</cite> or <cite>build_pua_offline.zip</cite>
installation script found here:</p>
<blockquote>
<div><p><a class="reference external" href="https://raw.githubusercontent.com/billchurch/f5-pua/master/build_pua.zip">https://raw.githubusercontent.com/billchurch/f5-pua/master/build_pua.zip</a></p>
<p><a class="reference external" href="https://raw.githubusercontent.com/billchurch/f5-pua/master/build_pua_offline.zip">https://raw.githubusercontent.com/billchurch/f5-pua/master/build_pua_offline.zip</a></p>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These requirements, and prerequisites have all been provisioned ahead of time for you.</p>
</div>
</div>
<div class="section" id="installation-overview">
<h2>Installation Overview<a class="headerlink" href="#installation-overview" title="Permalink to this headline">¶</a></h2>
<p>The installation will consist of installing and testing (in order)</p>
<ol class="arabic simple">
<li>BIG-IP Preparation</li>
<li>Script download and execution</li>
<li>Customization of APM policy</li>
</ol>
</div>
<div class="section" id="resource-table">
<h2>Resource Table<a class="headerlink" href="#resource-table" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="63%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Resource</strong></th>
<th class="head"><strong>Description</strong></th>
<th class="head"><strong>Value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WebSSH_proxy_vs_IP</td>
<td>Virtual server IP Address of WebSSH2 service.</td>
<td>10.1.10.240</td>
</tr>
<tr class="row-odd"><td>APM_Portal_vs_IP</td>
<td>Virtual server IP Address of APM portal for authentication</td>
<td>10.1.10.240</td>
</tr>
<tr class="row-even"><td>RADIUS_proxy_vs_IP</td>
<td>Virtual server IP address of RADIUS proxy service</td>
<td>10.1.10.240</td>
</tr>
<tr class="row-odd"><td>LDAP_proxy_vs_IP</td>
<td>Virtual server IP address of LDAP proxy service</td>
<td>10.1.10.240</td>
</tr>
<tr class="row-even"><td>LDAPS_proxy_vs_IP</td>
<td>Virtual server IP address of LDAPS proxy service</td>
<td>10.1.10.240</td>
</tr>
<tr class="row-odd"><td>LDAP_server_IP</td>
<td>IP Address of site LDAP or AD server (required for LDAP use)</td>
<td>10.1.10.240</td>
</tr>
<tr class="row-even"><td>RADIUS_server_IP</td>
<td>IP Address of site RADIUS server (if RADIUS bypass is used)</td>
<td>10.1.10.240</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>This script will configure a reference implementation of the F5 Privileged User Authentication solution.
The only requirements are a running and licensed system (“Active”), initial configuration complete
(licensed, VLANs, self IPs), and preferably already provisioned for LTM+APM+ILX. The script will check
for and can enable it for you if you wish.</p>
<p>You will be prompted for IP addresses for 5 services:</p>
<ul class="simple">
<li>WebSSH Proxy - This IP may be shared with other IPs on the BIG-IP system if the protocol/port (tcp/2222)
do not conflict. This proxy is ultimately called by the APM web top. It’s also important to note that
SNAT may not be used on this virtual server. (webssh_proxy)</li>
<li>RADIUS Proxy – This runs the RADIUS Ephemeral Authentication Service. This IP may be shared with other IPs
on the BIG-IP system if the protocol/port (udp/1812) do not conflict. (radius_proxy)</li>
<li>LDAP Proxy – This runs the LDAP Ephemeral Authentication Service. This IP may be shared with other IPs on
the BIG-IP system if the protocol/port (tcp/389) do not conflict. (ldap_proxy)</li>
<li>LDAPS Proxy – This runs the LDAPS (ssl) Ephemeral Authentication Service. This IP may be shared with other
IPs on the BIG-IP system if the protocol/port (tcp/636) do not conflict. (ldaps_proxy)</li>
<li>Web top – This runs the LDAP Ephemeral Authentication Service. This IP may be shared with other IPs on the
BIG-IP system if the protocol/port (tcp/443) do not conflict. By default SNAT is disabled for this vs as
the WebSSH proxy may not interoperate with SNAT. If you change this option be sure to institute some sort
of selective disable option (iRule) when connecting to the webssh_proxy as a portal resource.</li>
</ul>
<p>WebSSH, LDAPS, and web top will all be initially configured with a default client-ssl profile, after testing
this should be changed to use a legitimate certificate.</p>
<p>A blank APM policy is created and attached to the web top vs “pua_webtop”, this policy will need to be built
out for the pua_webtop service to operate correctly.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this lab, the scripts have been preloaded to /tmp, and we will be using build_pua_offline.sh and using Offline Installation Method.  The online instructions, in the event you wish to deploy in your own environment, can be located here:  <a class="reference external" href="https://raw.githubusercontent.com/billchurch/f5-pua/master/docs/PUA%20Solution%20Install%20Guide.docx">https://raw.githubusercontent.com/billchurch/f5-pua/master/docs/PUA%20Solution%20Install%20Guide.docx</a>  If the scripts do not appear in /tmp, they have also been copied to /root.</p>
</div>
</div>
<div class="section" id="offline-installation-method">
<h2>Offline Installation Method<a class="headerlink" href="#offline-installation-method" title="Permalink to this headline">¶</a></h2>
<p>This method utilizes the <cite>build_pua_offline.sh/zip</cite> method to
install the PUA solutions from a closed network or a BIG-IP with limited
or no Internet connectivity.</p>
</div>
<div class="section" id="run-installation-script">
<h2>Run Installation Script<a class="headerlink" href="#run-installation-script" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This lab utilizes the Non-Interactive Install mode. A file called pua_config.sh may be placed in the same directory as build_pua.sh or build_pua_offline.sh to fully automate the install, or provide defaults for a “semi-automatic” deployment. See pua_config.sh as an example.</p>
<p>When started, build_pua.sh or build_pua_offline.sh both check for the existence of this file.</p>
<p class="last">Additionally, most of the variables set in the top of pua_config.sh and pua_config_offline.sh may be overridden by this file.</p>
</div>
<ol class="arabic simple">
<li>Run <strong>/tmp/build_pua_offline.sh</strong> or <strong>/root/build_pua_offline.sh</strong></li>
<li>Win.</li>
</ol>
</div>
</div>
<div class="section" id="validation">
<h1>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="webssh2-client">
<h2>WebSSH2 Client<a class="headerlink" href="#webssh2-client" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Open a web browser and DO NOT navigate to the first URL given by the script.  The IP show in the script is internal and will not be accessible externally.  Instead, you will have to use the IP from the Student Portal “Webtop” link.</li>
</ol>
<p>example: <a class="reference external" href="https://[VS_IP]:2222/ssh/host/10.1.0.240">https://[VS_IP]:2222/ssh/host/10.1.0.240</a></p>
<ol class="arabic simple" start="2">
<li>Enter the username <strong>testuser</strong> with any password and click login.</li>
</ol>
<p><a class="reference internal" href="../../_images/image1.png"><img alt="image0" src="../../_images/image1.png" style="width: 3in;" /></a></p>
<ol class="arabic simple" start="3">
<li>You should be greeted with a tmsh prompt to the BIG-IP the script was installed on, logged in as the user <strong>*testuser*</strong>.</li>
</ol>
<p><a class="reference internal" href="../../_images/image210.png"><img alt="image1" src="../../_images/image210.png" style="width: 3in;" /></a></p>
</div>
<div class="section" id="apm-policy-and-portal-mode">
<h2>APM Policy and Portal Mode<a class="headerlink" href="#apm-policy-and-portal-mode" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Open a web browser and navigate to the second URL given by the script.</li>
</ol>
<p>example: <cite>https://[Public IP of Virtual Server]</cite></p>
<ol class="arabic simple" start="2">
<li>The sample USG Warning and Consent Banner should appear, click <strong>OK</strong>.</li>
</ol>
<p><a class="reference internal" href="../../_images/image310.png"><img alt="image2" src="../../_images/image310.png" style="width: 3in;" /></a></p>
<ol class="arabic simple" start="3">
<li>Enter a random username other than <em>testuser</em> and any password. Click <strong>Logon</strong>.</li>
</ol>
<p><a class="reference internal" href="../../_images/image410.png"><img alt="image3" src="../../_images/image410.png" style="width: 3in;" /></a></p>
<ol class="arabic simple" start="4">
<li>You should be directed to the webtop, click the <strong>WebSSH Portal</strong> icon.</li>
</ol>
<p><a class="reference internal" href="../../_images/image510.png"><img alt="image4" src="../../_images/image510.png" style="width: 3.32000in; height: 2.68000in;" /></a></p>
<ol class="arabic simple" start="5">
<li>You should be presented with another WebSSH2 screen, logged into the BIG-IP the script was installed on as the user you provided in step 3.</li>
</ol>
<p><a class="reference internal" href="../../_images/image610.png"><img alt="image5" src="../../_images/image610.png" style="width: 4.64000in; height: 1.96000in;" /></a></p>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="../labinfo.html" title="Lab Network Setup" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/clouddocs.js"></script>
  <script src="/assets/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>