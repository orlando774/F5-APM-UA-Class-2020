<!DOCTYPE html>
<head>
  
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PPZPQ6');</script>
  <!-- End Google Tag Manager -->
    <title>Module: Deploy ADFS Load Balancing Services</title>
  

  <meta charset="utf-8">
  <!-- Twitter Bootstrap viewport setting -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- F5 metadata -->
  <meta name="title" content="Module: Deploy ADFS Load Balancing Services"/>
  <meta name="product" content="F5 Identity and Access Management Solutions"/>
  <meta name="version" content=""/>
  <meta name="updated_date"  content="2020-05-19 03:36:25"/>
  <meta name="archived" content="Archived documents excluded"/>
  <meta name="doc_type" content="Manual"/>
  <meta name="lifecycle" content="release"/>
  <meta name="F5 Identity and Access Management Solutions" content=""/>


  

  
  <link href="https://cdn.f5.com/favicon.ico" rel="icon">

</head>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Module: Deploy ADFS Load Balancing Services &#8212; F5 Identity and Access Management Solutions  documentation</title>
    <link rel="stylesheet" href="../../_static/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/f5_agility_theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/f5.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/index.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/f5-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/CoveoFullSearch.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://use.fontawesome.com/21fb8a09c3.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Module: Deploy ADFS Proxy Services" href="../module3/module-adfs-proxy.html" />
    <link rel="prev" title="Module: Connect and Validate Environment" href="../module1/module-validate-environment.html" /> 
  </head><body>
  <div id="clouddocs-header"></div>

    <div id="sidebar" class="section-nav">
      <!-- javascript code to maintain the sidebar scroll positon when loaded -->
      <script type="text/javascript">
        $(function() {
          if (localStorage.tempScrollTop) {
            $('#sidebar').scrollTop(localStorage.tempScrollTop);
          }
        });
        $('#sidebar').on("scroll", function() {
          localStorage.setItem("tempScrollTop", $('#sidebar').scrollTop());
        });
      </script>
      
      <!--  version selector ------------------>
      <div id="version_selector_wrapper">
      </div>
      <nav class="nav-sidebartoc">

        
         <h5>F5 Identity and Access Management Solutions  </h5>
        
<div id="searchbox" role="search">
  <form class="search" action="../../search.html" method="get">
    <input type="text" class="search" name="q" placeholder=" Search..." />
    <button type="submit" class="btn btn-info navbar-btn"><i class="fa fa-search"></i></button>
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        <hr>
        <span class="nav-sidebartoc">
            <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../class1/class1.html">Class 1: SAML Federation with F5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class2/class2.html">Class 2: OAuth Federation with F5</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class3/class3.html">Class 3: SWG - Securing Outbound Internet Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class4/class4.html">Class 4: SAML Identity Provider (IdP) Lab</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../class5.html">Class 5: AD FS Proxy Lab</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../labinfo/labinfo.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module1/module-validate-environment.html">Module: Connect and Validate Environment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Module: Deploy ADFS Load Balancing Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module3/module-adfs-proxy.html">Module: Deploy ADFS Proxy Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../module4/module-additional.html">Module: Additional Information and Troubleshooting Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conclusion.html">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../class6/class6.html">Class 6: Federating Common Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class7/class7.html">Class 7: Introduction to Universal Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class8/class8.html">Class 8: Troubleshooting Universal Access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class9/class9.html">Class 9: Multi-Factor Auth for Cloud Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class10/class10.html">Class 10: Privileged User Access</a></li>
</ul>

        </span><!-- Use this file to add extra links to the bottom of the ToC sidebar -->
<hr>
  <span class="nav-sidebartoc">
 <!-- insert content here -->
  </span>
      </nav>
    </div>


    <div id="right-sidebar">
      <h7 style="font-weight:normal">On this page:</h7>
      <nav class="nav-sidebartoc">
        <span class="nav-sidebartoc">
            <ul>
<li><a class="reference internal" href="#">Module: Deploy ADFS Load Balancing Services</a><ul>
<li><a class="reference internal" href="#change-client-to-point-at-big-ip-load-balancing-virtual-server">Change Client to Point at BIG-IP Load Balancing Virtual Server</a></li>
<li><a class="reference internal" href="#deploy-adfs-iapp-for-adfs-load-balancing">Deploy ADFS iApp for ADFS Load Balancing</a></li>
<li><a class="reference internal" href="#test-the-adfs-load-balancing-functionality">Test the ADFS Load Balancing Functionality</a></li>
<li><a class="reference internal" href="#review-the-adfs-load-balancing-configuration">Review the ADFS Load Balancing Configuration</a></li>
</ul>
</li>
</ul>

         </span>
      </nav>
    </div>





  
  <div class="main active" id="content" >
    <article class="docs-container site-article-inner">
              <!-- custom breadcrumb -->
        <h5>
            <a href="../../index.html">F5 Identity and Access Management Solutions</a>
              &gt; <a href="../class5.html">Class 5: AD FS Proxy Lab</a>

          <span class="right">
             <a href="../../_sources/class5/module2/module-adfs-load-balancing.rst.txt" rel="nofollow">Source</a> |
             <a href="https://github.com/osantiago774/f5-agility-labs-iam">Edit on <i class="fa fa-github" aria-hidden="true"></i></a>
          </span>
        </h5>
        <!-- end custom breadcrumb -->
      


    <!--a title="Export PDF" id="export-pdf" class="btn btn btn-link pull-right">View PDF</a-->
    <button type="button" id="export-pdf" class="btn btn-link right">PDF</button>


    
     
         <div class="sidebar" id="version-warning" style="display: none;">
           <p class="first sidebar-title">
           <span class="icon fa fa-info-circle fa-lg"></span> Version notice:</p>
           <p class="last" id="currentVersion"></p>
          </div>


     <div role="main">
        
  <div class="section" id="module-deploy-adfs-load-balancing-services">
<h1>Module: Deploy ADFS Load Balancing Services<a class="headerlink" href="#module-deploy-adfs-load-balancing-services" title="Permalink to this headline">¶</a></h1>
<p>In this module you will deploy simple load balancing of ADFS for
internal users. No proxy services are needed for internal users.</p>
<div class="section" id="change-client-to-point-at-big-ip-load-balancing-virtual-server">
<h2>Change Client to Point at BIG-IP Load Balancing Virtual Server<a class="headerlink" href="#change-client-to-point-at-big-ip-load-balancing-virtual-server" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Double click the BIG-IP ADFS Load Balancer desktop shortcut</li>
</ol>
<p><a class="reference internal" href="../../_images/image1103.png"><img alt="image0" src="../../_images/image1103.png" style="width: 1.23611in; height: 1.73611in;" /></a></p>
<ol class="arabic simple" start="2">
<li>You should see that the HOSTS file now points ADFS at the load
balancing virtual server (which is not yet created)</li>
</ol>
<p><a class="reference internal" href="../../_images/image224.png"><img alt="image1" src="../../_images/image224.png" style="width: 4.02778in; height: 1.29698in;" /></a></p>
<ol class="arabic simple" start="3">
<li>Close any open Chrome incognito windows</li>
<li>Open a new Chrome window if not already open.</li>
<li>Right click the “ADFS Demo App shortcut” and open a new incognito window<ol class="loweralpha">
<li>It should fail because you cannot access ADFS through the BIG-IP
until you deploy the configuration.</li>
<li>If it is still working, you may need to close Chrome and/or retry
the HOSTS file shortcut.</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="deploy-adfs-iapp-for-adfs-load-balancing">
<h2>Deploy ADFS iApp for ADFS Load Balancing<a class="headerlink" href="#deploy-adfs-iapp-for-adfs-load-balancing" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Open the BIG-IP configuration interface</li>
<li>Open Local Traffic -&gt; Virtual Servers and notice nothing is deployed</li>
<li>Open iApps -&gt; Application Services -&gt; Applications</li>
<li>Click Create</li>
</ol>
<p>Accept all default values except for those listed below.</p>
<ol class="arabic simple" start="5">
<li><strong>Name</strong>: <strong>adfs-lb</strong></li>
<li><strong>Template</strong>: <strong>f5.microsoft_adfs.v1.2.0rc7</strong></li>
<li><strong>SSL Encryption</strong><ol class="loweralpha">
<li><strong>How should the BIG-IP system handle SSL traffic?</strong><ol class="lowerroman">
<li><strong>Encrypted traffic is forwarded without decryption (SSL
pass-through)</strong></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>SSL Pass-Through is chosen because Microsoft requires it for supported
load balancing of ADFS. SSL Bridging breaks the connectivity between WAP
servers and ADFS servers because client certificate authentication is
required. You can use SSL Bridging if you will not point WAP servers at
your deployment but following Microsoft’s guidelines and using SSL
Pass-Through is recommended.</p>
<ol class="arabic simple" start="8">
<li><strong>High Availability</strong><ol class="loweralpha">
<li><strong>What IP address do you want to use for the virtual server?</strong><ol class="lowerroman">
<li><strong>10.1.20.100</strong></li>
</ol>
</li>
</ol>
</li>
</ol>
<p>10.1.20.x is the internal network in this environment.</p>
<ol class="loweralpha simple">
<li><strong>Which FQDN will clients use to access AD FS?</strong><ol class="lowerroman">
<li><strong>adfs.vlab.f5demo.com</strong></li>
</ol>
</li>
<li><strong>Which servers should be included in this pool?</strong><ol class="lowerroman">
<li><strong>10.1.20.6</strong></li>
<li>Click Add</li>
<li><strong>10.1.20.7</strong></li>
</ol>
</li>
</ol>
<p><a class="reference internal" href="../../_images/image317.png"><img alt="image2" src="../../_images/image317.png" style="width: 4.47222in; height: 2.01346in;" /></a></p>
<ol class="arabic simple" start="9">
<li>Click Finished</li>
</ol>
</div>
<div class="section" id="test-the-adfs-load-balancing-functionality">
<h2>Test the ADFS Load Balancing Functionality<a class="headerlink" href="#test-the-adfs-load-balancing-functionality" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Close any open Chrome incognito windows</li>
<li>Open a new Chrome window if not already open</li>
<li>Right click the “ADFS Demo App” shortcut and open in an incognito window</li>
</ol>
<p><a class="reference internal" href="../../_images/image416.png"><img alt="image3" src="../../_images/image416.png" style="width: 2.48148in; height: 0.92839in;" /></a></p>
<ol class="arabic simple" start="4">
<li>You should see a set of claims displayed in the claims app at
app.vlab.f5demo.com</li>
</ol>
<p><a class="reference internal" href="../../_images/image515.png"><img alt="image4" src="../../_images/image515.png" style="width: 4.81482in; height: 2.08488in;" /></a></p>
<ol class="loweralpha simple">
<li>Note that ADFS is still identifying the user as inside the corporate
network because the user did not go through an MS-ADFSPIP compliant
proxy solution.</li>
<li>What happened:<ol class="lowerroman">
<li>You made a request to App</li>
<li>App redirected you to ADFS for authentication</li>
<li><strong>The BIG-IP received the request and load balanced it to one of
the ADFS servers (this is the only change from last time)</strong></li>
<li>ADFS authenticated you automatically with Windows Integrated
Authentication with your domain joined computer</li>
<li>ADFS redirected you back to App with a WS-Fed assertion</li>
<li>App validated the assertion and displayed the claims it received
from ADFS</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="review-the-adfs-load-balancing-configuration">
<h2>Review the ADFS Load Balancing Configuration<a class="headerlink" href="#review-the-adfs-load-balancing-configuration" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Go to Local Traffic -&gt; Virtual Servers</li>
<li>Notice there are two deployed, one on port 443 and one on port 49443<ol class="loweralpha">
<li>443 is for ADFS traffic<ol class="lowerroman">
<li>Pool members use port 443</li>
</ol>
</li>
<li>49443 is for client certificate auth support<ol class="lowerroman">
<li>Pool members use port 49443</li>
</ol>
</li>
</ol>
</li>
</ol>
</div>
</div>


     </div>
    
     <div class="row next-prev-btn-row">
       <div class="col-lg-12">
       
        <a href="../module1/module-validate-environment.html" title="Module: Connect and Validate Environment" accesskey="p" class="btn btn-primary left"><i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Previous</a>
       
       
          <a href="../module3/module-adfs-proxy.html" title="Module: Deploy ADFS Proxy Services" accesskey="n" class="btn btn-primary right">Next <i class="fa fa-arrow-circle-right" aria-hidden="true"></i></a>
       
     </div>
     </div>
    

    </article>
  </div>

</div>


  <div id="clouddocs-footer"></div>
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->

  <script src="../../_static/js/index.js"></script>
  <script src="../../_static/js/jquery.appear.js"></script>
  <script src="../../_static/js/printThis.js"></script>
  <script src="/assets/js/bootstrap.min.js"></script>
  <script src="/assets/js/clouddocs.js"></script>
  <script src="/assets/js/CoveoJsSearch.Lazy.min.js"></script>
  </body>
</html>